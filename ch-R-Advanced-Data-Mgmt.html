<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 9 R 고급 데이터 변환 | R 프로그래밍 (개정판)</title>
<meta name="author" content="Kilhwan Kim">
<meta name="description" content="7 장과 8 장에서 정돈 형식의 데이터를 변환하고 시각화하는 방법을 배웠다. 그러나 실제 데이터 분석에서는 분석하고자 하는 데이터가 하나의 데이터 프레임에 정돈 형식으로 제공되는 경우가 많지 않다. 대부분의 경우 다음 두 가지 작업 중 하나 또는 두 가지 모두가 필요한 경우가 많다. [Merge] 다양한 원천에서 획득된 데이터를 하나의 정돈 형식의...">
<meta name="generator" content="bookdown 0.33 with bs4_book()">
<meta property="og:title" content="Chapter 9 R 고급 데이터 변환 | R 프로그래밍 (개정판)">
<meta property="og:type" content="book">
<meta property="og:description" content="7 장과 8 장에서 정돈 형식의 데이터를 변환하고 시각화하는 방법을 배웠다. 그러나 실제 데이터 분석에서는 분석하고자 하는 데이터가 하나의 데이터 프레임에 정돈 형식으로 제공되는 경우가 많지 않다. 대부분의 경우 다음 두 가지 작업 중 하나 또는 두 가지 모두가 필요한 경우가 많다. [Merge] 다양한 원천에서 획득된 데이터를 하나의 정돈 형식의...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 9 R 고급 데이터 변환 | R 프로그래밍 (개정판)">
<meta name="twitter:description" content="7 장과 8 장에서 정돈 형식의 데이터를 변환하고 시각화하는 방법을 배웠다. 그러나 실제 데이터 분석에서는 분석하고자 하는 데이터가 하나의 데이터 프레임에 정돈 형식으로 제공되는 경우가 많지 않다. 대부분의 경우 다음 두 가지 작업 중 하나 또는 두 가지 모두가 필요한 경우가 많다. [Merge] 다양한 원천에서 획득된 데이터를 하나의 정돈 형식의...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.2/transition.js"></script><script src="libs/bs3compat-0.4.2/tabs.js"></script><script src="libs/bs3compat-0.4.2/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-176754989-1"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-176754989-1');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R 프로그래밍 (개정판)</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li><a class="" href="ch-intro.html"><span class="header-section-number">1</span> R 설치 및 시작</a></li>
<li><a class="" href="ch-R-Data-Basic.html"><span class="header-section-number">2</span> R 데이터 기초</a></li>
<li><a class="" href="ch-R-Vectors.html"><span class="header-section-number">3</span> R 벡터</a></li>
<li><a class="" href="ch-R-Matrix.html"><span class="header-section-number">4</span> R 행렬</a></li>
<li><a class="" href="ch-R-List.html"><span class="header-section-number">5</span> R 리스트</a></li>
<li><a class="" href="ch-R-Data-Frame.html"><span class="header-section-number">6</span> R 데이터 프레임</a></li>
<li><a class="" href="ch-dataTransformation.html"><span class="header-section-number">7</span> dplyr을 이용한 데이터 변환</a></li>
<li><a class="" href="ch-visualization.html"><span class="header-section-number">8</span> ggplot2를 이용한 데이터 시각화</a></li>
<li><a class="active" href="ch-R-Advanced-Data-Mgmt.html"><span class="header-section-number">9</span> R 고급 데이터 변환</a></li>
<li><a class="" href="ch-R-Programming-Structure.html"><span class="header-section-number">10</span> R 프로그래밍 구조</a></li>
<li><a class="" href="ch-R-OOP.html"><span class="header-section-number">11</span> R 객체 지향 프로그래밍</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="ch-RandPython.html"><span class="header-section-number">A</span> R과 Python 연동하기</a></li>
<li><a class="" href="ch-RTips.html"><span class="header-section-number">B</span> R 관련 여러 주제들</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="ch-R-Advanced-Data-Mgmt" class="section level1" number="9">
<h1>
<span class="header-section-number">9</span> R 고급 데이터 변환<a class="anchor" aria-label="anchor" href="#ch-R-Advanced-Data-Mgmt"><i class="fas fa-link"></i></a>
</h1>
<p><a href="ch-dataTransformation.html#ch-dataTransformation">7</a> 장과 <a href="ch-visualization.html#ch-visualization">8</a> 장에서 정돈 형식의 데이터를 변환하고 시각화하는 방법을 배웠다. 그러나 실제 데이터 분석에서는 분석하고자 하는 데이터가 하나의 데이터 프레임에 정돈 형식으로 제공되는 경우가 많지 않다. 대부분의 경우 다음 두 가지 작업 중 하나 또는 두 가지 모두가 필요한 경우가 많다.</p>
<ul>
<li>[Merge] 다양한 원천에서 획득된 데이터를 하나의 정돈 형식의 데이터로 결합하기</li>
<li>[Reshape] 비정돈 형식의 데이터를 정돈 데이터 형식으로 변형하기</li>
</ul>
<p>본 장에서는 이러한 데이터 전처리에 필요한 다양한 기법을 논의한다.
데이터의 결합을 위해서는 <code>dplyr</code> 패키지를 사용할 것이며, 비정돈 형식의 데이터를 정돈 데이터 형식으로 변형하기 위해서는 <code>tidyr</code> 패키지를 사용할 것이다. 이 두 패키지는 모두 <code>tidyverse</code> 패키지에 속해 있으므로, 이 두 패키지를 사용하기 위해서 <code>tidyverse</code> 패키지를 적재한다.</p>
<div class="sourceCode" id="cb1792"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
<div id="데이터의-단순-결합" class="section level2" number="9.1">
<h2>
<span class="header-section-number">9.1</span> 데이터의 단순 결합<a class="anchor" aria-label="anchor" href="#%EB%8D%B0%EC%9D%B4%ED%84%B0%EC%9D%98-%EB%8B%A8%EC%88%9C-%EA%B2%B0%ED%95%A9"><i class="fas fa-link"></i></a>
</h2>
<div id="행으로-결합-vs.-열로-결합" class="section level4 unnumbered">
<h4>행으로 결합 vs. 열로 결합<a class="anchor" aria-label="anchor" href="#%ED%96%89%EC%9C%BC%EB%A1%9C-%EA%B2%B0%ED%95%A9-vs.-%EC%97%B4%EB%A1%9C-%EA%B2%B0%ED%95%A9"><i class="fas fa-link"></i></a>
</h4>
<p>데이터에 대한 결합이 필요한 다음 두 가지 상황을 고려해 보자.</p>
<ul>
<li><p>데이터가 동일한 열 형식으로 여러 파일로 나뉘어져 있는 경우: 예를 들어 판매 실적 데이터가 2021년 데이터는 2021.csv 파일에 2022년 데이터는 2022.csv 파일에 있다고 가정해 보자. 이 경우 각 파일을 별도의 데이터 프레임으로 읽어들인 후 행으로 결합시켜야 할 것이다.</p></li>
<li><p>데이터가 동일한 행으로 되어 있으나, 서로 다른 열을 가지고 있는 경우: 예를 들어 사원 번호 순으로 한 파일에는 입사시점의 개인 정보가, 다른 파일에는 작년 인사 평가 결과 데이터가 있다고 하자. 두 파일에 동일한 사원 번호 순으로 데이터가 기록되어 있다면 두 파일의 정보를 데이터 프레임으로 읽어들인 후 열로 결합하여야 할 것이다.</p></li>
</ul>
<p>데이터 프레임을 행과 열로 결합하는 작업은 <a href="ch-R-Data-Frame.html#ch-R-Data-Frame">6</a> 장에서 소개한 R의 기본 함수인 <code><a href="https://rdrr.io/r/base/cbind.html">rbind()</a></code>와 <code><a href="https://rdrr.io/r/base/cbind.html">cbind()</a></code>를 사용하여도 수행할 수 있다. 그러나 여기에서는 dplyr 패키지의 <code><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows()</a></code>와 <code><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols()</a></code> 함수를 사용하여 여러 데이터 프레임을 행과 열로 결합할 것이다.
<code><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows()</a></code>와 <code><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols()</a></code> 함수를 사용하는 이유는 이 두 함수가 R의 기본 함수보다 처리 속도가 빠를 뿐 아니라, R의 기본 함수보다는 편리한 기능을 가지고 있기 때문이다.</p>
</div>
<div id="데이터를-행으로-결합하기" class="section level3" number="9.1.1">
<h3>
<span class="header-section-number">9.1.1</span> 데이터를 행으로 결합하기<a class="anchor" aria-label="anchor" href="#%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A5%BC-%ED%96%89%EC%9C%BC%EB%A1%9C-%EA%B2%B0%ED%95%A9%ED%95%98%EA%B8%B0"><i class="fas fa-link"></i></a>
</h3>
<div id="열-구조가-다른-데이터를-행으로-결합하기" class="section level4 unnumbered">
<h4>열 구조가 다른 데이터를 행으로 결합하기<a class="anchor" aria-label="anchor" href="#%EC%97%B4-%EA%B5%AC%EC%A1%B0%EA%B0%80-%EB%8B%A4%EB%A5%B8-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A5%BC-%ED%96%89%EC%9C%BC%EB%A1%9C-%EA%B2%B0%ED%95%A9%ED%95%98%EA%B8%B0"><i class="fas fa-link"></i></a>
</h4>
<p>데이터를 행으로 결합하는 작업이 필요한 경우, 데이터가 동일한 열 구조를 가지고 있지 않은 경우가 종종 발생한다. 동일한 열을 가지고 있더라도 열 이름이 서로 다른 경우도 있다. 이런 경우에는 결합하려는 데이터 프레임을 동일한 열 구조로 변형하여 결합하여야 한다.</p>
<p>앞으로의 예제들은 다음 파일에 포함된 데이터를 사용하니 예제를 따라하고자 하는 분들은 내려받기를 하자.</p>
<a href="data:application/octet-stream;base64,H4sIAAAAAAAAA61Uz2sTQRSe7I+kCf4oeiqIh95bsF5KvTQ/SKg1NZQUWxHKsjsNKUlWdhe8RqngQfHYVlopgqDgQYpKevAfSrZnD2rjm903yexkY6Fa+Dpv3rzZmfd9X2a1sH47s54hhKhEA6g6hERfqxZn5gnRFJgkYCENY9JsGK57Cyqvw2wCcJmVAq4CrgGmANOAXcAkrrGd6e5J2z8+8l/siYm9p6eHn3jCP/wSrWCJSMXp/qtup9N7vT/4eHitRJkHxbEZrWw0qHDhRNBvCNaiJl046e8c+G86fNY9/t7tfB6sffvYe/aBz3ov2/7RznBfx3/3XDhpBbAGqAAeARaEtTuAB4AiYAOQkzvLjgS5mCCqkt4ymtTFL01gUlkqcCZWYJkLWqItizp8ZYMaPE5lLcuhrsun5brlUafJjyjWW0aDb6tSoynfIXAK3oEnM5bhGbNbDjs/Wp527Cez/NqMHKUN//r9/k8YzmJdOIcuTOEOJuAlAMvdAMwI+WUEo3pVyN9H2u9hPIn50H5v30t+hETUsV8PpApI8IrwWyhRfiQoDAOp9q9mHt5dQTAj3wwZUvr4rdSI6CroF6udYIZQR6wHY0RcERyg8gPGKqr1JQF/xQiYMTwPfGe0TIoiqrgrjSLy54StTaGg0yjqrlDLCUgIsTzy2hPAQ8AmwIrBpkSiOkKing9MjS7MBk1cmJgfMcSoj7c9ZESRbTH6AORFC3FbVLBL9uIsSx0pMUKnKo69TU3vvwqsmdmaKK1Ip343+JnHTJIlmzpsX6Q+mbMbns3NqFfrtcF7hRNCrrD6xSwJ/hYXcCy1wyBe1sxW3XG94NHhjxCoG0moRo1emJffMbykzKWWaTfHUcMJGE+URKVIRixPA2pCKhbnkZo58o/UJOvYyLjez2eNsUPO/gAVeyz4fggAAA==" download="advancedDataMgmt.RData">Download advancedDataMgmt.RData</a>
<p>내려받은 파일을 우클릭하여 RStudio로 열거나 내려받은 파일이 있는 폴더를 작업디렉토리로 설정한 후 다음 명령을 수행하면
class1과 class2 등의 데이터가 적재된다. 이 데이터는 대학의 어떤 강의의 두 분반의 중간 및 기말 고사 정보이다.</p>
<div class="sourceCode" id="cb1793"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"advancedDataMgmt.RData"</span><span class="op">)</span></span>
<span><span class="va">class1</span></span></code></pre></div>
<pre><code>#&gt;    ID   Name Gender Year Address Midterm Final Team
#&gt; 1  15 김철수      M    1    서울      78    59    A
#&gt; 2  18 김영희      F    3    경기      85    87    A
#&gt; 3  25 이철수      M    3    충남      80    70    B
#&gt; 4  34 이영희      F    2    대전      92    89    B
#&gt; 5 151 홍길동   Male    4    세종      58    66    B</code></pre>
<div class="sourceCode" id="cb1795"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">class2</span></span></code></pre></div>
<pre><code>#&gt;   ID Mid Final   Name Team Gen Year
#&gt; 1 12  75    79 장철수    C   M    2
#&gt; 2 19  75    89 장영희    C   F    2
#&gt; 3 28  87    76 최철수    D   M    1
#&gt; 4 45  82    79 최영희    D   F   30</code></pre>
<p>두 데이터 모두 학번(ID), 중간고사(Midterm), 기말고사(Final), 프로젝트 팀(Team), 성별(Gender), 학년(Year)에 대한 정보를 포함하고 있으나, class1에는 학생의 주소(Address) 열이 포함되어 있고 class2는 그렇지 않다. 또한 두 데이터의 열의 위치와 이름도 조금 다르다.</p>
</div>
<div id="rbind는-열의-개수가-다른-데이터-프레임을-행으로-결합하지-못한다." class="section level4 unnumbered">
<h4>
<code>rbind()</code>는 열의 개수가 다른 데이터 프레임을 행으로 결합하지 못한다.<a class="anchor" aria-label="anchor" href="#rbind%EB%8A%94-%EC%97%B4%EC%9D%98-%EA%B0%9C%EC%88%98%EA%B0%80-%EB%8B%A4%EB%A5%B8-%EB%8D%B0%EC%9D%B4%ED%84%B0-%ED%94%84%EB%A0%88%EC%9E%84%EC%9D%84-%ED%96%89%EC%9C%BC%EB%A1%9C-%EA%B2%B0%ED%95%A9%ED%95%98%EC%A7%80-%EB%AA%BB%ED%95%9C%EB%8B%A4."><i class="fas fa-link"></i></a>
</h4>
<p>두 분반 학생의 점수를 통합하여 성적 처리를 하기 위해 두 분반의 데이터를 결합하려고 한다고 하자. 이를 어떻게 수행하여야 할까? <code><a href="https://rdrr.io/r/base/cbind.html">rbind()</a></code>로 먼저 두 데이터 프레임을 통합하려고 시도해 보자.</p>
<div class="sourceCode" id="cb1797"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">class1</span>, <span class="va">class2</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; Error in rbind(deparse.level, ...): numbers of columns of arguments do not match</code></pre>
<p>열의 수가 다르기 때문에 결합이 되지 않음을 알 수 있다. 따라서 <code><a href="https://rdrr.io/r/base/cbind.html">rbind()</a></code>로 두 데이터를 결합하려면 class1에만 있는 Address 열을 어떻게 처리할지를 결정해야 한다. 일반적으로 다음 둘 중 하나의 방법을 택하여 문제를 해결한다. 첫번째 방법은 class1의 Address 열을 제외하고 결합하는 것이고, 두번째 방법은 class2에 Address 열을 추가하고 결측치(NA)로 값을 준 후 결합하는 것이다.</p>
</div>
<div id="bind_rows는-열의-개수가-다른-데이터-프레임임도-행으로-결합을-한다." class="section level4 unnumbered">
<h4>
<code>bind_rows()</code>는 열의 개수가 다른 데이터 프레임임도 행으로 결합을 한다.<a class="anchor" aria-label="anchor" href="#bind_rows%EB%8A%94-%EC%97%B4%EC%9D%98-%EA%B0%9C%EC%88%98%EA%B0%80-%EB%8B%A4%EB%A5%B8-%EB%8D%B0%EC%9D%B4%ED%84%B0-%ED%94%84%EB%A0%88%EC%9E%84%EC%9E%84%EB%8F%84-%ED%96%89%EC%9C%BC%EB%A1%9C-%EA%B2%B0%ED%95%A9%EC%9D%84-%ED%95%9C%EB%8B%A4."><i class="fas fa-link"></i></a>
</h4>
<p>두 분반 학생의 데이터를 dplyr 패키지의 <code><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows()</a></code> 함수를 사용하여 연결해 보자.</p>
<div class="sourceCode" id="cb1799"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">class1</span>, <span class="va">class2</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;    ID   Name Gender Year Address Midterm Final Team Mid  Gen
#&gt; 1  15 김철수      M    1    서울      78    59    A  NA &lt;NA&gt;
#&gt; 2  18 김영희      F    3    경기      85    87    A  NA &lt;NA&gt;
#&gt; 3  25 이철수      M    3    충남      80    70    B  NA &lt;NA&gt;
#&gt; 4  34 이영희      F    2    대전      92    89    B  NA &lt;NA&gt;
#&gt; 5 151 홍길동   Male    4    세종      58    66    B  NA &lt;NA&gt;
#&gt; 6  12 장철수   &lt;NA&gt;    2    &lt;NA&gt;      NA    79    C  75    M
#&gt; 7  19 장영희   &lt;NA&gt;    2    &lt;NA&gt;      NA    89    C  75    F
#&gt; 8  28 최철수   &lt;NA&gt;    1    &lt;NA&gt;      NA    76    D  87    M
#&gt; 9  45 최영희   &lt;NA&gt;   30    &lt;NA&gt;      NA    79    D  82    F</code></pre>
<p>열의 개수가 달라도 결합이 이루어지는 것을 볼 수 있다. 두 데이터에서 서로 없는 열은 결측치 <code>NA</code>로 처리되어 결합이 이루어지는 것을 볼 수 있다. 그러나 사실 <code>class1</code>의 <code>Midterm</code>과 <code>class2</code>의 <code>Mid</code>는 중간고사 점수 열로 같은 정보가 다른 열 이름으로 표현된 것 뿐이다. <code><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows()</a></code>는 이름이 다르면 서로 다른 열이라고 생각하여 각각 새로운 열을 만들어 결합을 한다. 그러므로 사실상 같은 열이 서로 다른 이름으로 되어 있다면 이름을 동일하게 바꾸어 주어서 결합을 하여야 한다.</p>
</div>
<div id="rbind는-두-데이터의-열의-이름이-다른-경우-행으로-결합하지-못한다." class="section level4 unnumbered">
<h4>
<code>rbind()</code>는 두 데이터의 열의 이름이 다른 경우 행으로 결합하지 못한다.<a class="anchor" aria-label="anchor" href="#rbind%EB%8A%94-%EB%91%90-%EB%8D%B0%EC%9D%B4%ED%84%B0%EC%9D%98-%EC%97%B4%EC%9D%98-%EC%9D%B4%EB%A6%84%EC%9D%B4-%EB%8B%A4%EB%A5%B8-%EA%B2%BD%EC%9A%B0-%ED%96%89%EC%9C%BC%EB%A1%9C-%EA%B2%B0%ED%95%A9%ED%95%98%EC%A7%80-%EB%AA%BB%ED%95%9C%EB%8B%A4."><i class="fas fa-link"></i></a>
</h4>
<p><code>class1</code> 데이터의 Address 열을 제외하고 두 데이터를 다시 <code><a href="https://rdrr.io/r/base/cbind.html">rbind()</a></code>로 결합해 보자.</p>
<div class="sourceCode" id="cb1801"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">class1</span>, <span class="op">-</span><span class="va">Address</span><span class="op">)</span>, <span class="va">class2</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; Error in match.names(clabs, names(xi)): 이전에 사용된 이름들과 일치하지 않습니다.</code></pre>
<p><code><a href="https://rdrr.io/r/base/cbind.html">rbind()</a></code>는 열의 개수가 동일하더라도 두 데이터 프레임의 열의 이름이 서로 다르면 행으로 결합하지 못함을 볼 수 있다. 지금 중간고사 점수 열과 성별 열의 이름이 서로 다르기 때문에 연결이 안되는 것이므로 다음처럼 열의 이름을 변경한 후 두 데이터 프레임을 행으로 연결시킨다.</p>
<div class="sourceCode" id="cb1803"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">class1</span>, <span class="op">-</span><span class="va">Address</span><span class="op">)</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="va">class2</span>, Midterm <span class="op">=</span> <span class="va">Mid</span>, Gender <span class="op">=</span> <span class="va">Gen</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;    ID   Name Gender Year Midterm Final Team
#&gt; 1  15 김철수      M    1      78    59    A
#&gt; 2  18 김영희      F    3      85    87    A
#&gt; 3  25 이철수      M    3      80    70    B
#&gt; 4  34 이영희      F    2      92    89    B
#&gt; 5 151 홍길동   Male    4      58    66    B
#&gt; 6  12 장철수      M    2      75    79    C
#&gt; 7  19 장영희      F    2      75    89    C
#&gt; 8  28 최철수      M    1      87    76    D
#&gt; 9  45 최영희      F   30      82    79    D</code></pre>
</div>
<div id="rbind와-bind_rows는-열의-순서를-자동으로-맞춘다." class="section level4 unnumbered">
<h4>
<code>rbind()</code>와 <code>bind_rows()</code>는 열의 순서를 자동으로 맞춘다.<a class="anchor" aria-label="anchor" href="#rbind%EC%99%80-bind_rows%EB%8A%94-%EC%97%B4%EC%9D%98-%EC%88%9C%EC%84%9C%EB%A5%BC-%EC%9E%90%EB%8F%99%EC%9C%BC%EB%A1%9C-%EB%A7%9E%EC%B6%98%EB%8B%A4."><i class="fas fa-link"></i></a>
</h4>
<p>이제 두 데이터 프레임의 열의 형태가 같아졌으므로 <code><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows()</a></code>로 두 데이터를 원하는 방식으로 합칠 수 있다.
두 데이터 프레임의 열의 순서가 다른 경우 <code><a href="https://rdrr.io/r/base/cbind.html">rbind()</a></code>와 <code><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows()</a></code>는 첫번째 데이터 프레임의 열 이름을 기준으로 열의 순서를 자동으로 맞추어 준다.</p>
<div class="sourceCode" id="cb1805"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">class12</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">class1</span>, <span class="op">-</span><span class="va">Address</span><span class="op">)</span>, </span>
<span>             <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="va">class2</span>, Midterm <span class="op">=</span> <span class="va">Mid</span>, Gender <span class="op">=</span> <span class="va">Gen</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">class12</span></span></code></pre></div>
<pre><code>#&gt;    ID   Name Gender Year Midterm Final Team
#&gt; 1  15 김철수      M    1      78    59    A
#&gt; 2  18 김영희      F    3      85    87    A
#&gt; 3  25 이철수      M    3      80    70    B
#&gt; 4  34 이영희      F    2      92    89    B
#&gt; 5 151 홍길동   Male    4      58    66    B
#&gt; 6  12 장철수      M    2      75    79    C
#&gt; 7  19 장영희      F    2      75    89    C
#&gt; 8  28 최철수      M    1      87    76    D
#&gt; 9  45 최영희      F   30      82    79    D</code></pre>
</div>
<div id="합쳐지는-데이터에-식별자-부여하기" class="section level4 unnumbered">
<h4>합쳐지는 데이터에 식별자 부여하기<a class="anchor" aria-label="anchor" href="#%ED%95%A9%EC%B3%90%EC%A7%80%EB%8A%94-%EB%8D%B0%EC%9D%B4%ED%84%B0%EC%97%90-%EC%8B%9D%EB%B3%84%EC%9E%90-%EB%B6%80%EC%97%AC%ED%95%98%EA%B8%B0"><i class="fas fa-link"></i></a>
</h4>
<p>앞의 class1과 class2 데이터는 1분반과 2분반 학생의 데이터이다. 그런데 이 두 데이터를 행으로 결합한 데이터에서는 각 행이 어떤 데이터에서 온 것인지에 대한 정보가 없기 때문에 학생이 속한 분반을 확인할 수 없다.
이런 경우 <code><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows()</a></code>의 <code>.id</code> 인수를 사용하면, 결합되는 데이터의 순서에 따라 일련번호를 부여하는 열을 생성할 수 있다.</p>
<div class="sourceCode" id="cb1807"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">class1</span>, <span class="op">-</span><span class="va">Address</span><span class="op">)</span>, </span>
<span>         <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="va">class2</span>, Midterm <span class="op">=</span> <span class="va">Mid</span>, Gender <span class="op">=</span> <span class="va">Gen</span><span class="op">)</span>,</span>
<span>         .id <span class="op">=</span> <span class="st">"Class"</span><span class="op">)</span>  <span class="co"># class 열로 데이터 출처 식별</span></span></code></pre></div>
<pre><code>#&gt;   Class  ID   Name Gender Year Midterm Final Team
#&gt; 1     1  15 김철수      M    1      78    59    A
#&gt; 2     1  18 김영희      F    3      85    87    A
#&gt; 3     1  25 이철수      M    3      80    70    B
#&gt; 4     1  34 이영희      F    2      92    89    B
#&gt; 5     1 151 홍길동   Male    4      58    66    B
#&gt; 6     2  12 장철수      M    2      75    79    C
#&gt; 7     2  19 장영희      F    2      75    89    C
#&gt; 8     2  28 최철수      M    1      87    76    D
#&gt; 9     2  45 최영희      F   30      82    79    D</code></pre>
<p>실제 데이터를 행으로 결합하는 과정에는 훨씬 더 다양한 문제들이 발생한다. 예를 들어 동일한 키를 나타내는 열이 하나는 cm로 하나는 m 단위로 정보가 주어져 있으면 이를 하나의 단위로 통일해야 한다. 그러나 복잡한 문제들도 결국 서로 다른 열 구조를 행으로 결합하기 위해서 어떤 열을 추가하거나 제외할 것인지를 결정하고, 열의 형식과 이름을 어떻게 통일할 것인가를 고려하는 과정이라는 점에서 본질적으로는 앞의 예와 동일하다 할 수 있다.</p>
</div>
</div>
<div id="데이터를-열로-결합하기" class="section level3" number="9.1.2">
<h3>
<span class="header-section-number">9.1.2</span> 데이터를 열로 결합하기<a class="anchor" aria-label="anchor" href="#%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A5%BC-%EC%97%B4%EB%A1%9C-%EA%B2%B0%ED%95%A9%ED%95%98%EA%B8%B0"><i class="fas fa-link"></i></a>
</h3>
<div id="행-순서가-다른-데이터를-열로-결합하기" class="section level4 unnumbered">
<h4>행 순서가 다른 데이터를 열로 결합하기<a class="anchor" aria-label="anchor" href="#%ED%96%89-%EC%88%9C%EC%84%9C%EA%B0%80-%EB%8B%A4%EB%A5%B8-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A5%BC-%EC%97%B4%EB%A1%9C-%EA%B2%B0%ED%95%A9%ED%95%98%EA%B8%B0"><i class="fas fa-link"></i></a>
</h4>
<p>데이터를 열로 결합하는 경우 실제 데이터가 동일한 행 순서로 정렬되어 있지 않은 경우가 종종 있다.
예를 들어 앞의 예에서 성적 처리를 위해서는 학생의 중간, 기말 고사 점수와 함께 출석 점수를 고려해야 한다고 하자. 그리고 출석점수는 attendance 데이터 프레임에 다음과 같이 class1과 class2의 모든 학생의 학번(ID) 순으로 정렬되어 분반 정보(Class)와 출석 점수(Attend)가 저장되어 있다고 하자.</p>
<div class="sourceCode" id="cb1809"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">attendance</span></span></code></pre></div>
<pre><code>#&gt;    ID Class Attend
#&gt; 1  12     2    185
#&gt; 2  15     1     90
#&gt; 3  18     1     95
#&gt; 4  19     2    100
#&gt; 5  25     1    100
#&gt; 6  28     2    100
#&gt; 7  34     1    100
#&gt; 8  45     2    100
#&gt; 9 151     1     95</code></pre>
<p>앞서 두 분반의 중간 및 기말 고사 데이터가 합쳐진 <code>class12</code>는 학번이 기준이 아니라 분반으로 정렬되어 있다. 따라서 이 두 데이터 프레임을 단순하게 열로 결합하면 출석점수가 엉뚱한 학생에게 부여된다.</p>
</div>
<div id="정렬-후-열로-결합하기" class="section level4 unnumbered">
<h4>정렬 후 열로 결합하기<a class="anchor" aria-label="anchor" href="#%EC%A0%95%EB%A0%AC-%ED%9B%84-%EC%97%B4%EB%A1%9C-%EA%B2%B0%ED%95%A9%ED%95%98%EA%B8%B0"><i class="fas fa-link"></i></a>
</h4>
<p>이를 해결하는 가장 간단한 방법은 두 데이터 프레임을 동일한 기준으로 정렬한 후 <code><a href="https://rdrr.io/r/base/cbind.html">cbind()</a></code>나 <code><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols()</a></code>를 수행하는 것이다.
먼저 class12를 ID 순으로 정렬한 후 열로 결합해 보자.
그런데 ID 열은 두 데이터 프레임에 모두 있으므로 하나는 불필요하다. 따라서 attendance 데이터 프레임의 ID 열을 제거한 후 결합한다.</p>
<div class="sourceCode" id="cb1811"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">class12.a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">class12</span>, <span class="va">ID</span><span class="op">)</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">attendance</span>, <span class="op">-</span><span class="va">ID</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">class12.a</span></span></code></pre></div>
<pre><code>#&gt;    ID   Name Gender Year Midterm Final Team Class Attend
#&gt; 1  12 장철수      M    2      75    79    C     2    185
#&gt; 2  15 김철수      M    1      78    59    A     1     90
#&gt; 3  18 김영희      F    3      85    87    A     1     95
#&gt; 4  19 장영희      F    2      75    89    C     2    100
#&gt; 5  25 이철수      M    3      80    70    B     1    100
#&gt; 6  28 최철수      M    1      87    76    D     2    100
#&gt; 7  34 이영희      F    2      92    89    B     1    100
#&gt; 8  45 최영희      F   30      82    79    D     2    100
#&gt; 9 151 홍길동   Male    4      58    66    B     1     95</code></pre>
<p>다른 방법으로 attendance 데이터 프레임을 Class와 ID 열로 정렬한 후 class12 데이터 프레임과 결합할 수도 있다. attendence 데이터를 분반과 학번으로 정렬하여 class112와 순서를 맞춘 후 데이터를 열로 결합해 보자.</p>
<div class="sourceCode" id="cb1813"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">class12.b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols</a></span><span class="op">(</span><span class="va">class12</span>, </span>
<span>                <span class="va">attendance</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">Class</span>, <span class="va">ID</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">ID</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">class12.b</span></span></code></pre></div>
<pre><code>#&gt;    ID   Name Gender Year Midterm Final Team Class Attend
#&gt; 1  15 김철수      M    1      78    59    A     1     90
#&gt; 2  18 김영희      F    3      85    87    A     1     95
#&gt; 3  25 이철수      M    3      80    70    B     1    100
#&gt; 4  34 이영희      F    2      92    89    B     1    100
#&gt; 5 151 홍길동   Male    4      58    66    B     1     95
#&gt; 6  12 장철수      M    2      75    79    C     2    185
#&gt; 7  19 장영희      F    2      75    89    C     2    100
#&gt; 8  28 최철수      M    1      87    76    D     2    100
#&gt; 9  45 최영희      F   30      82    79    D     2    100</code></pre>
<p>실제 데이터는 이보다 더 복잡한 문제를 가지고 있는 경우가 많다. 예를 들어 한 파일에 있는 행이 다른 파일에는 없는 경우도 있다. 이러한 경우엔 그 행의 정보를 모두 제거할 것인지, 아니면 그 행에 대해 없는 정보는 NA로 하여 결합을 할지 결정해야 한다. 결국 <code><a href="https://rdrr.io/r/base/cbind.html">cbind()</a></code>나 <code><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows()</a></code>를 이용하여 열로 결합하기 위해서는 두 데이터의 행이 동일한 개체에 대한 정보가 되도록 일치시키는 것이 중요하다. 그런데 매번 두 데이터가 동일한 행으로 결합되도록 정렬하여 결합하는 작업을 사용자가 직접 하는 것은 오류 발생 가능성이 많다. 따라서 이 작업은 다음에 소개하는 ’관계형 데이터베이스처럼 데이터 결합하기’에 소개하는 방법을 사용할 것을 권장한다.</p>
</div>
</div>
</div>
<div id="관계형-데이터베이스처럼-데이터-결합하기" class="section level2" number="9.2">
<h2>
<span class="header-section-number">9.2</span> 관계형 데이터베이스처럼 데이터 결합하기<a class="anchor" aria-label="anchor" href="#%EA%B4%80%EA%B3%84%ED%98%95-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4%EC%B2%98%EB%9F%BC-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EA%B2%B0%ED%95%A9%ED%95%98%EA%B8%B0"><i class="fas fa-link"></i></a>
</h2>
<p>관계형 데이터베이스에서는 서로 다른 열 정보를 담고 있는 두 데이터 테이블을 key를 사용하여 join이라는 방식을 이용하여 연결시킨다. 여기서 key란 앞서 성적 데이터와 출석 데이터에서 특정 학생 정보임을 식별할 수 있는 학번(ID) 등을 말한다.</p>
<p>R에서도 두 데이터 프레임을 관계형 데이터베이스의 join과 같은 방식으로 결합시킬 수 있다. 이 작업은 R의 기본 함수인 <code><a href="https://rdrr.io/r/base/merge.html">merge()</a></code> 함수를 이용하여 수행할 수도 있고, dplyr 패키지의 join 함수들을 사용하여 수행할 수도 있다. 이 책에서는 dplyr의 join 함수들을 이용하여 관계형 데이터베이스처럼 결합하기를 수행하는 방법을 설명하도록 한다.</p>
<div id="inner-join과-outer-join" class="section level3" number="9.2.1">
<h3>
<span class="header-section-number">9.2.1</span> Inner join과 outer join<a class="anchor" aria-label="anchor" href="#inner-join%EA%B3%BC-outer-join"><i class="fas fa-link"></i></a>
</h3>
<p>앞의 예에서 우리는 중간, 기말 고사 점수를 가지고 있는 <code>class12</code> 데이터 프레임과 출석 점수를 가지고 있는 <code>attendance</code> 데이터 프레임을 합치기 위해 ID 열로 데이터 프레임을 정렬한 후 <code><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols()</a></code>로 연결하였다. 이 작업은 dplyr의 <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code> 함수를 이용하면 더 손쉽게 수행할 수 있다.</p>
<div id="inner_join" class="section level4 unnumbered">
<h4>
<code>inner_join()</code><a class="anchor" aria-label="anchor" href="#inner_join"><i class="fas fa-link"></i></a>
</h4>
<p><code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code> 함수는 결합할 두 데이터 프레임을 인수로 먼저 기술한 다음 <code>by</code> 인수에 어떤 열을 기준으로 결합할 것인지를 열 이름으로 기술한다. <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code> 함수는 두 데이터 프레임에서 <code>by</code> 인수로 주어진 열의 값이 동일한 행을 서로 연결하여 새로운 데이터 프레임을 만든다. 또한 새로 만들어진 데이터 프레임은 <code>by</code> 열을 기준으로 정렬이 이루어진다.</p>
<div class="sourceCode" id="cb1815"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">class12</span>, <span class="va">attendance</span>, by<span class="op">=</span><span class="st">"ID"</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;    ID   Name Gender Year Midterm Final Team Class Attend
#&gt; 1  15 김철수      M    1      78    59    A     1     90
#&gt; 2  18 김영희      F    3      85    87    A     1     95
#&gt; 3  25 이철수      M    3      80    70    B     1    100
#&gt; 4  34 이영희      F    2      92    89    B     1    100
#&gt; 5 151 홍길동   Male    4      58    66    B     1     95
#&gt; 6  12 장철수      M    2      75    79    C     2    185
#&gt; 7  19 장영희      F    2      75    89    C     2    100
#&gt; 8  28 최철수      M    1      87    76    D     2    100
#&gt; 9  45 최영희      F   30      82    79    D     2    100</code></pre>
<ul>
<li>만약 두 데이터 프레임이 결합의 기준이 되는 열의 이름이 다르면 `by = c(“key.x” = “key.y”) 형식으로 두 데이터 프레임의 키 열의 이름을 기술하여 결합하면 된다.</li>
<li>만약 결합의 기준이 되는 열이 두 개 이상이면 `by = c(“key1”, “key2”) 형식으로 기술한다.</li>
<li>만약 결합의 기준이 되는 열이 두 개 이상이고 서로 이름이 다르면 <code>by = c("key1.x" = "key1.y", "key2.x" = "key2.y")</code> 형식으로 두 데이터 프레임의 키 열의 이름을 기술한다. 관련 정보는 <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code> 함수의 도움말을 참조하라.</li>
</ul>
</div>
<div id="inner-join" class="section level4 unnumbered">
<h4>1:1 inner join<a class="anchor" aria-label="anchor" href="#inner-join"><i class="fas fa-link"></i></a>
</h4>
<p>앞의 예처럼 데이터가 결합되는 방식을 1 대 1 inner join이라고 부른다. 두 데이터 프레임에 ID가 동일한 학생은 오직 한 명만 존재하고, 두 데이터 프레임의 학생의 ID가 일 대 일로 대응된다. 따라서 두 데이터 프레임의 행들이 일 대 일로 결합되어 새로운 데이터 프레임이 생성된다.</p>
<p><code>by</code> 인수가 주어지지 않으면 <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code> 함수는 두 데이터 프레임에서 이름이 같은 열을 찾고 그 열을 기준으로 결합을 한다. 따라서 위의 경우 <code>by</code> 인수를 설정하지 않으면, 두 데이터 프레임에 공통으로 있는 ID 열을 기준으로 데이터가 결합된다.</p>
<div class="sourceCode" id="cb1817"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">class12</span>, <span class="va">attendance</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; Joining with `by = join_by(ID)`</code></pre>
<pre><code>#&gt;    ID   Name Gender Year Midterm Final Team Class Attend
#&gt; 1  15 김철수      M    1      78    59    A     1     90
#&gt; 2  18 김영희      F    3      85    87    A     1     95
#&gt; 3  25 이철수      M    3      80    70    B     1    100
#&gt; 4  34 이영희      F    2      92    89    B     1    100
#&gt; 5 151 홍길동   Male    4      58    66    B     1     95
#&gt; 6  12 장철수      M    2      75    79    C     2    185
#&gt; 7  19 장영희      F    2      75    89    C     2    100
#&gt; 8  28 최철수      M    1      87    76    D     2    100
#&gt; 9  45 최영희      F   30      82    79    D     2    100</code></pre>
</div>
<div id="inner-join-1" class="section level4 unnumbered">
<h4>0:1 inner join<a class="anchor" aria-label="anchor" href="#inner-join-1"><i class="fas fa-link"></i></a>
</h4>
<p>앞서 <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code> 함수는 두 데이터 프레임에서 <code>by</code> 인수로 주어진 열의 값이 같은 행을 서로 연결한다고 했다. 그러면 한 데이터 프레임에는 해당 개체의 정보가 있으나 다른 데이터 프레임에는 해당 개체의 정보가 없는 경우에 두 데이터 프레임을 연결하면 어떻게 될까?
다음 예처럼 <code>class1</code>에는 1분반 학생의 데이터만 있고, <code>attendance</code>는 1, 2분반의 학생 데이터가 모두 있는 경우 두 데이터 프레임을 <code>ID</code> 열로 결합하는 경우를 고려해 보자. <code>attendance</code>에는 동일한 <code>ID</code>를 가지고 있는 학생이 오직 한 명만 존재하고, <code>class1</code>에는 <code>attendance</code>에 있는 학생 정보가 0개 또는 1개가 있는 경우이다. 이러한 데이터 결합 방식을 0 대 1 inner join이라고 부른다.</p>
<p>Inner join은 두 데이터 프레임에서 <code>by</code>로 지정된 열이 값이 서로 대응이 되는 행만 남겨둔다. 따라서 위의 경우에는 <code>class1</code>에 있는 학생의 행으로만 구성된 데이터 프레임이 생성된다. 즉, <code>by</code> 인수에 주어진 열이 서로 동일한 값을 가진 행만 결합되어 결과가 나오므로 한 쪽 데이터 프레임에 없는 행은 제거되었음을 알 수 있다.</p>
<div class="sourceCode" id="cb1820"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">class1</span>, <span class="va">attendance</span>, by<span class="op">=</span><span class="st">"ID"</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;    ID   Name Gender Year Address Midterm Final Team Class Attend
#&gt; 1  15 김철수      M    1    서울      78    59    A     1     90
#&gt; 2  18 김영희      F    3    경기      85    87    A     1     95
#&gt; 3  25 이철수      M    3    충남      80    70    B     1    100
#&gt; 4  34 이영희      F    2    대전      92    89    B     1    100
#&gt; 5 151 홍길동   Male    4    세종      58    66    B     1     95</code></pre>
</div>
<div id="outer-join" class="section level4 unnumbered">
<h4>outer join<a class="anchor" aria-label="anchor" href="#outer-join"><i class="fas fa-link"></i></a>
</h4>
<p>한 쪽 데이터 프레임에 해당 행이 없더라도 어느 한쪽의 데이터 프레임에 행이 있으면 그 행을 포함시킬 필요가 있는 경우가 있다. 예를 들어 앞의 예에서 2분반의 중간 및 기말 고사 정보가 나중에 획득되면 추후 보강하기로 하고 현재 출석 점수가 있는 모든 학생의 정보가 나오도록 중간과 기말 점수와 출석 데이터를 결합한다고 하자.<br>
이러한 경우 outer_join 함수들을 사용한다. Outer join 함수는 다음 세 가지가 있다.</p>
<ul>
<li>
<code>left_join(x, y)</code>: x에 있는 행을 모두 유지하여 join을 수행한다.</li>
<li>
<code>right_join(x, y)</code>: y에 있는 행을 모두 유지하여 join을 수행한다.</li>
<li>
<code>full_join(x, y)</code>: x와 y의 모든 행을 유지하여 join을 수행한다.</li>
</ul>
<p>대신 한 쪽에 없는 정보는 모두 결측치 <code>NA</code>가 입력되어 결합된다.
다음은 <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join()</a></code>의 차이가 무엇인지를 보여주는 예이다.</p>
<div class="sourceCode" id="cb1822"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, name <span class="op">=</span> <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>; <span class="va">x</span></span></code></pre></div>
<pre><code>#&gt;   id name
#&gt; 1  1    a
#&gt; 2  2    b
#&gt; 3  3    c</code></pre>
<div class="sourceCode" id="cb1824"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">4</span>, addr <span class="op">=</span> <span class="va">LETTERS</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>; <span class="va">y</span></span></code></pre></div>
<pre><code>#&gt;   id addr
#&gt; 1  2    B
#&gt; 2  3    C
#&gt; 3  4    D</code></pre>
<div class="sourceCode" id="cb1826"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; Joining with `by = join_by(id)`</code></pre>
<pre><code>#&gt;   id name addr
#&gt; 1  2    b    B
#&gt; 2  3    c    C</code></pre>
<div class="sourceCode" id="cb1829"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; Joining with `by = join_by(id)`</code></pre>
<pre><code>#&gt;   id name addr
#&gt; 1  1    a &lt;NA&gt;
#&gt; 2  2    b    B
#&gt; 3  3    c    C</code></pre>
<div class="sourceCode" id="cb1832"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; Joining with `by = join_by(id)`</code></pre>
<pre><code>#&gt;   id name addr
#&gt; 1  2    b    B
#&gt; 2  3    c    C
#&gt; 3  4 &lt;NA&gt;    D</code></pre>
<div class="sourceCode" id="cb1835"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; Joining with `by = join_by(id)`</code></pre>
<pre><code>#&gt;   id name addr
#&gt; 1  1    a &lt;NA&gt;
#&gt; 2  2    b    B
#&gt; 3  3    c    C
#&gt; 4  4 &lt;NA&gt;    D</code></pre>
<p>다음은 <code>class1</code>과 <code>attendance</code> 데이터에서 <code>attendance</code>의 모든 행을 남겨두는 outer join을 수행한 결과이다.</p>
<div class="sourceCode" id="cb1838"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join</a></span><span class="op">(</span><span class="va">class1</span>, <span class="va">attendance</span>, by<span class="op">=</span><span class="st">"ID"</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;    ID   Name Gender Year Address Midterm Final Team Class Attend
#&gt; 1  15 김철수      M    1    서울      78    59    A     1     90
#&gt; 2  18 김영희      F    3    경기      85    87    A     1     95
#&gt; 3  25 이철수      M    3    충남      80    70    B     1    100
#&gt; 4  34 이영희      F    2    대전      92    89    B     1    100
#&gt; 5 151 홍길동   Male    4    세종      58    66    B     1     95
#&gt; 6  12   &lt;NA&gt;   &lt;NA&gt;   NA    &lt;NA&gt;      NA    NA &lt;NA&gt;     2    185
#&gt; 7  19   &lt;NA&gt;   &lt;NA&gt;   NA    &lt;NA&gt;      NA    NA &lt;NA&gt;     2    100
#&gt; 8  28   &lt;NA&gt;   &lt;NA&gt;   NA    &lt;NA&gt;      NA    NA &lt;NA&gt;     2    100
#&gt; 9  45   &lt;NA&gt;   &lt;NA&gt;   NA    &lt;NA&gt;      NA    NA &lt;NA&gt;     2    100</code></pre>
</div>
<div id="n-inner-join" class="section level4 unnumbered">
<h4>1:n inner join<a class="anchor" aria-label="anchor" href="#n-inner-join"><i class="fas fa-link"></i></a>
</h4>
<p>만약에 한 데이터 프레임에서 결합의 기준이 되는 열에 동일한 값이 여러번 나오면 어떻게 될까? 다음의 예를 살펴보면서 그 결과가 어떻게 되는지 확인해 보자.
지금까지 우리는 <code>class12.a</code>라는 데이터 프레임에 중간, 기말, 출석 점수를 통합하였다. 그런데 다음과 같이 프로젝트 팀별로 프로젝트 평가 점수가 있다고 하자.</p>
<div class="sourceCode" id="cb1840"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pjt</span></span></code></pre></div>
<pre><code>#&gt;   Team Project
#&gt; 1    A      80
#&gt; 2    B      90
#&gt; 3    C      85
#&gt; 4    D      75</code></pre>
<p>한 프로젝트 팀에는 2, 3 명의 학생이 포함되고, 프로젝트 점수는 프로젝트 팀별로 주어지고 학생 개별로는 부여되지 않는다. 따라서 학생의 성적을 산정하려면 각 학생이 어떤 프로젝트 팀에 속한지를 확인한 후 학생이 속한 프로젝트 팀의 점수를 그 학생의 프로젝트 점수로 부여하는 작업이 필요하다.
이 경우 <code>class12.a</code>와 <code>pjt</code> 데이터 프레임이 결합되어야 하는데, 결합의 기준 열은 프로젝트 팀을 나타내는 <code>Team</code> 열이 되어야 한다. 그런데 <code>pjt</code> 데이터 프레임에는 한 팀에 해당되는 행이 오직 한 개만 존재하지만, <code>class12.a</code> 데이터 프레임에는 한 팀에 속한 학생이 여러 명 있으므로 여러 행이 존재한다. 이러한 경우의 데이터 결합 방식을 1 대 n inner join이라고 한다.<br>
다음은 <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code>를 사용하여 n 대 1의 관계의 두 데이터 프레임을 inner join 한 결과이다.</p>
<div class="sourceCode" id="cb1842"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">class12.c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">class12.a</span>, <span class="va">pjt</span>, by<span class="op">=</span><span class="st">"Team"</span><span class="op">)</span></span>
<span><span class="va">class12.c</span></span></code></pre></div>
<pre><code>#&gt;    ID   Name Gender Year Midterm Final Team Class Attend Project
#&gt; 1  12 장철수      M    2      75    79    C     2    185      85
#&gt; 2  15 김철수      M    1      78    59    A     1     90      80
#&gt; 3  18 김영희      F    3      85    87    A     1     95      80
#&gt; 4  19 장영희      F    2      75    89    C     2    100      85
#&gt; 5  25 이철수      M    3      80    70    B     1    100      90
#&gt; 6  28 최철수      M    1      87    76    D     2    100      75
#&gt; 7  34 이영희      F    2      92    89    B     1    100      90
#&gt; 8  45 최영희      F   30      82    79    D     2    100      75
#&gt; 9 151 홍길동   Male    4      58    66    B     1     95      90</code></pre>
<p>결과에서 보듯이 <code>by</code> 인수로 <code>Team</code>을 주게 되면, <code>pjt</code> 데이터 프레임에서 <code>Team</code>이 A인 행은 하나지만, <code>class12.a</code>에서 <code>Team</code>이 A이고 학번이 15번과 18번인 학생과 관련된 두 행이 존재하므로, <code>pjt</code>의 한 행이 이 두 행에 차례로 결합되어 새로운 행을 만들었음을 알 수 있다. 이처럼 <code>inner_joint()</code>는 <code>by</code> 인수로 주어진 행에 동일한 값이 여러번 있으면 해당 값으로 결합이 여러번 발생한다.</p>
</div>
<div id="두-열-이상을-기준으로-join" class="section level4 unnumbered">
<h4>두 열 이상을 기준으로 join<a class="anchor" aria-label="anchor" href="#%EB%91%90-%EC%97%B4-%EC%9D%B4%EC%83%81%EC%9D%84-%EA%B8%B0%EC%A4%80%EC%9C%BC%EB%A1%9C-join"><i class="fas fa-link"></i></a>
</h4>
<p>Join의 기준이 되는 열은 하나가 아니라 여러 개가 될 수 있다. 다음과 같은 두 개의 데이터 프레임이 있다고 하자. 그리고 이 두 데이터 프레임을 하나의 데이터 프레임으로 결합한다고 하자.</p>
<div class="sourceCode" id="cb1844"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cAge</span></span></code></pre></div>
<pre><code>#&gt;   first.name last.name age
#&gt; 1      James    Bolton  34
#&gt; 2      James     Tiger  26
#&gt; 3     Goerge     Tiger  47</code></pre>
<div class="sourceCode" id="cb1846"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cIncome</span></span></code></pre></div>
<pre><code>#&gt;   first.name last.name income
#&gt; 1     Goerge     Tiger     35
#&gt; 2      James    Bolton     24
#&gt; 3      James     Tiger     18</code></pre>
<p>두 데이터 프레임 각각에는 한 사람에 대한 정보는 오직 한 행에만 정보가 기술되어 있다. 그러나 두 데이터 프레임에서 <code>first.name</code>이 동일한 사람이 2명, <code>last.name</code>이 동일한 사람이 2명이 있다. 그래서 <code>first.name</code>이나 <code>last.name</code>만으로 데이터를 결합한다면 동일한 이름을 가진 사람이 있어서 원하는 결과를 얻을 수 없다. 다음은 <code>first.name</code>으로 결합한 결과이다.</p>
<div class="sourceCode" id="cb1848"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">cAge</span>, <span class="va">cIncome</span>, by<span class="op">=</span><span class="st">"first.name"</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; Warning in inner_join(cAge, cIncome, by = "first.name"): Detected an unexpected many-to-many relationship between `x` and `y`.
#&gt; ℹ Row 1 of `x` matches multiple rows in `y`.
#&gt; ℹ Row 2 of `y` matches multiple rows in `x`.
#&gt; ℹ If a many-to-many relationship is expected, set `relationship =
#&gt;   "many-to-many"` to silence this warning.</code></pre>
<pre><code>#&gt;   first.name last.name.x age last.name.y income
#&gt; 1      James      Bolton  34      Bolton     24
#&gt; 2      James      Bolton  34       Tiger     18
#&gt; 3      James       Tiger  26      Bolton     24
#&gt; 4      James       Tiger  26       Tiger     18
#&gt; 5     Goerge       Tiger  47       Tiger     35</code></pre>
<p>결과에서 보듯이 <code>cAge</code>의 James Bolton 행은 <code>cIncome</code>의 James Bolton과 James Tiger 행과 <code>first.name</code>이 동일하므로 두 번 결합이 이루어진다. 마찬가지로 <code>cAge</code>의 James Tiger 행도 <code>cIncome</code>의 James Bolton과 James Tiger 행과 first.name이 동일하므로 역시 두 번 행 결합이 발생한다. 그래서 결합된 결과가 3건이 아니라 총 5건의 데이터 행을 갖는다.
그리고 <code>cAge</code>와 <code>cIncome</code> 모두 <code>last.name</code> 열이 있어서 어떤 <code>last.name</code>을 남겨두어야 할지 모르므로, 첫번째 데이터 프레임에서 온 열은 .x, 두번째 데이터 프레임에서 온 열은 .y라는 접미사를 붙여서 열을 만들었다.</p>
<p>이러한 경우는 <code>first.name</code>과 <code>last.name</code>이 모두 같은 경우에만 행이 결합되도록 하는 것이 더 바람직하다. 그렇게 하려면 이 두 열의 이름을 모두 by 인수로 전달하면 된다.</p>
<div class="sourceCode" id="cb1851"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">cAge</span>, <span class="va">cIncome</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"last.name"</span>, <span class="st">"first.name"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;   first.name last.name age income
#&gt; 1      James    Bolton  34     24
#&gt; 2      James     Tiger  26     18
#&gt; 3     Goerge     Tiger  47     35</code></pre>
</div>
</div>
<div id="filtering-join" class="section level3" number="9.2.2">
<h3>
<span class="header-section-number">9.2.2</span> Filtering join<a class="anchor" aria-label="anchor" href="#filtering-join"><i class="fas fa-link"></i></a>
</h3>
<p>지금까지는 두 데이터 프레임의 키 값이 같은 행을 inner 또는 outer join으로 연결하는 방법을 살펴보았다. 그런데 어떤 경우에는 한 데이터 프레임의 데이터를 다른 데이터 프레임의 정보를 사용하여 필터링해야 하는 경우가 있다. 다음의 두 예를 고려해 보자.</p>
<ul>
<li><p>어떤 도시의 거주자의 자산 데이터와 그 도시의 세금 체납자 데이터가 있다고 하자. 이 때 거주자의 자산 정보에서 세금 체납자의 자산 정보만 뽑아서 분석하려고 한다. 어떻게 이 정보를 뽑아낼 수 있을까?</p></li>
<li><p>어떤 텍스트에서 사용된 단어 데이터와 의마가 없는 단어인 불용어 데이터가 있다고 하자. 이 때 텍스트의 단어 데이터에서 불용어는 제외하고 데이터를 분석하려고 한다. 어떻게 이 정보를 뽑아낼 수 있을까?</p></li>
</ul>
<p>dplyr 패키지에는 이 작업을 위해 다음 두 함수를 제공한다.</p>
<ul>
<li>
<code>semi_join(x, y)</code>: <code>x</code> 데이터 프레임에서 <code>y</code>에 있는 데이터만 뽑아낸다. Inner join과 다른 점은 두 데이터 프레임의 정보를 결합하지 않는다는 것이다. <code>x</code> 데이터 프레임에서 남겨둘 행을 지정하기 위해서만 <code>y</code>를 사용한다.</li>
<li>
<code>anti_join(x, y)</code>: <code>x</code> 데이터 프레임에서 <code>y</code>에 있는 행은 제외한다.</li>
</ul>
<div class="sourceCode" id="cb1853"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;   id name
#&gt; 1  2    b
#&gt; 2  3    c</code></pre>
<div class="sourceCode" id="cb1855"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;   id name
#&gt; 1  1    a</code></pre>
</div>
<div id="join을-수행하는-다른-방법들" class="section level3" number="9.2.3">
<h3>
<span class="header-section-number">9.2.3</span> Join을 수행하는 다른 방법들<a class="anchor" aria-label="anchor" href="#join%EC%9D%84-%EC%88%98%ED%96%89%ED%95%98%EB%8A%94-%EB%8B%A4%EB%A5%B8-%EB%B0%A9%EB%B2%95%EB%93%A4"><i class="fas fa-link"></i></a>
</h3>
<div id="merge-함수" class="section level4" number="9.2.3.1">
<h4>
<span class="header-section-number">9.2.3.1</span> <code>merge()</code> 함수<a class="anchor" aria-label="anchor" href="#merge-%ED%95%A8%EC%88%98"><i class="fas fa-link"></i></a>
</h4>
<p>R의 기본 함수인 <code><a href="https://rdrr.io/r/base/merge.html">merge()</a></code> 함수는 dplyr 패키지의 inner와 outer join을 수행해 준다.</p>
<div class="sourceCode" id="cb1857"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>                 <span class="co"># inner join</span></span></code></pre></div>
<pre><code>#&gt;   id name addr
#&gt; 1  2    b    B
#&gt; 2  3    c    C</code></pre>
<div class="sourceCode" id="cb1859"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>   <span class="co"># left join</span></span></code></pre></div>
<pre><code>#&gt;   id name addr
#&gt; 1  1    a &lt;NA&gt;
#&gt; 2  2    b    B
#&gt; 3  3    c    C</code></pre>
<div class="sourceCode" id="cb1861"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, all.y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>   <span class="co"># right join</span></span></code></pre></div>
<pre><code>#&gt;   id name addr
#&gt; 1  2    b    B
#&gt; 2  3    c    C
#&gt; 3  4 &lt;NA&gt;    D</code></pre>
<div class="sourceCode" id="cb1863"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>     <span class="co"># full join</span></span></code></pre></div>
<pre><code>#&gt;   id name addr
#&gt; 1  1    a &lt;NA&gt;
#&gt; 2  2    b    B
#&gt; 3  3    c    C
#&gt; 4  4 &lt;NA&gt;    D</code></pre>
</div>
<div id="sqldf-패키지" class="section level4 unnumbered">
<h4>sqldf 패키지<a class="anchor" aria-label="anchor" href="#sqldf-%ED%8C%A8%ED%82%A4%EC%A7%80"><i class="fas fa-link"></i></a>
</h4>
<p>지금까지 dplyr의 join 함수를 이용하여 관계형 데이터베이스의 join과 유사한 데이터 결합을 어떻게 수행하는지 살펴보았다. 그런데 관계형 데이터베이스의 SQL에 익숙한 사람들은 R에서 SQL처럼 좀 더 다양한 방식으로 join을 수행할 수 없을까라는 의문을 가질 수 있다. sqldf 패키지는 SQL 문법을 이용하여 R의 데이터 프레임에서 데이터를 조회하거나 결합할 수 있도록 해 준다. 이러한 기능이 필요한 사람은 이 패키지의 문서를 참조하기 바란다. 그러나 R은 데이터 분석을 위한 도구이지 관계형 데이터베이스와 같은 일을 수행하기 위한 도구가 아님을 명심할 필요가 있다. 대량의 데이터의 결합이 필요하다면 관계형 데이터베이스에서 SQL을 이용하여 이를 먼저 수행한 후 최종 결과를 R로 보내어 분석을 수행하는 것이 일반적으로 더 효율적인 방법이다.</p>
</div>
</div>
</div>
<div id="sec-tidyr" class="section level2" number="9.3">
<h2>
<span class="header-section-number">9.3</span> <code>tidyr</code> 패키지를 이용하여 정돈 데이터 형식으로 바꾸기<a class="anchor" aria-label="anchor" href="#sec-tidyr"><i class="fas fa-link"></i></a>
</h2>
<p><code>tidyr</code> 패키지는 <code>tidyverse</code> 패키지에 포함된 패키지로 비정돈 형식의 데이터를 정돈 형식으로 바꾸어주는 함수를 가지고 있다.</p>
<div id="pivot_longer-여러-열에-걸친-한-변수의-데이터를-하나의-열로-길게-모으기" class="section level3" number="9.3.1">
<h3>
<span class="header-section-number">9.3.1</span> <code>pivot_longer</code>: 여러 열에 걸친 한 변수의 데이터를 하나의 열로 길게 모으기<a class="anchor" aria-label="anchor" href="#pivot_longer-%EC%97%AC%EB%9F%AC-%EC%97%B4%EC%97%90-%EA%B1%B8%EC%B9%9C-%ED%95%9C-%EB%B3%80%EC%88%98%EC%9D%98-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A5%BC-%ED%95%98%EB%82%98%EC%9D%98-%EC%97%B4%EB%A1%9C-%EA%B8%B8%EA%B2%8C-%EB%AA%A8%EC%9C%BC%EA%B8%B0"><i class="fas fa-link"></i></a>
</h3>
<p>정돈 데이터는 한 열이 하나의 변수에 대응을 해야 한다. 그러나 현실의 데이터에서는 동일한 변수의 값이 여러 열에 흩뿌려져 있는 경우가 발생한다. 시계열 데이터들이 대표적인 사례라 할 수 있다. 다음은 <code>tidyr</code>에 포함된 <code>table4a</code> 데이터이다. 세 나라의 1999년도와 2000년도의 어떤 사건의 발생 건수를 보여주고 있다. 발생 건수를 나타내는 데이터 열이 두 개의 열로 나눠져 있음을 볼 수 있다.</p>
<div class="sourceCode" id="cb1865"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">table4a</span></span></code></pre></div>
<pre><code>#&gt; # A tibble: 3 × 3
#&gt;   country     `1999` `2000`
#&gt;   &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;
#&gt; 1 Afghanistan    745   2666
#&gt; 2 Brazil       37737  80488
#&gt; 3 China       212258 213766</code></pre>
<p><code>table4a</code>를 정돈 데이터로 바꾸려면 두 열을 한 열로 모아야 한다. <code>tidyr</code>의 <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> 함수는 그러한 역할을 수행한다.</p>
<div class="sourceCode" id="cb1867"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">table4a</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">`1999`</span>, <span class="va">`2000`</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"year"</span>, values_to <span class="op">=</span><span class="st">"cases"</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; # A tibble: 6 × 3
#&gt;   country     year   cases
#&gt;   &lt;chr&gt;       &lt;chr&gt;  &lt;dbl&gt;
#&gt; 1 Afghanistan 1999     745
#&gt; 2 Afghanistan 2000    2666
#&gt; 3 Brazil      1999   37737
#&gt; 4 Brazil      2000   80488
#&gt; 5 China       1999  212258
#&gt; 6 China       2000  213766</code></pre>
<ul>
<li>
<code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code>에 모아야 할 열의 이름을 지정한다. 이 예에서는 1999와 2000이다. 두 열의 이름은 숫자로 시작하고 있어서 표준적인 형태를 따르지 않아서 <code>` `</code>으로 둘러쌓여 표현되었다.</li>
<li>원 데이터의 열 이름을 표현할 변수를 <code>names_to</code>로 지정한다.</li>
<li>원 데이터의 열의 값을 표현할 변수를 <code>values_to</code>로 지정한다.</li>
</ul>
<p>원 데이터의 열 이름은 변수로서 따옴표 없이 지정되고, 결과 데이터에 만들 열 이름은 아직 만들어진 변수가 아니므로 변수의 이름이 따옴표로 둘러쌓여 문자열로 전달된다.</p>
<p>다음 그림은 앞의 <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> 함수의 작동 방식을 보여준다. 원 데이터보다 길어진 형식으로 데이터가 변환되므로 longer라는 표현이 사용되었다.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-13"></span>
<img src="img/tidy-gather.png" alt="pivot_longer 작동 방식 (출처: R for Data Science)" width="60%"><p class="caption">
Figure 9.1: pivot_longer 작동 방식 (출처: R for Data Science)
</p>
</div>
<div id="결측치가-있는-경우" class="section level4 unnumbered">
<h4>결측치가 있는 경우<a class="anchor" aria-label="anchor" href="#%EA%B2%B0%EC%B8%A1%EC%B9%98%EA%B0%80-%EC%9E%88%EB%8A%94-%EA%B2%BD%EC%9A%B0"><i class="fas fa-link"></i></a>
</h4>
<p><code>table4a</code>에서 중국의 2000년도 데이터가 조사되지 않아서 <code>NA</code>로 표시되어 있다면 <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code>는 어떤 결과를 줄까? 다음 결과에서 보듯이 결측치가 있는 셀도 모두 별도의 행으로 표현이 된다.</p>
<div class="sourceCode" id="cb1869"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">na_table4a</span> <span class="op">&lt;-</span> <span class="va">table4a</span></span>
<span><span class="va">na_table4a</span><span class="op">$</span><span class="va">`2000`</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">na_table4a</span></span></code></pre></div>
<pre><code>#&gt; # A tibble: 3 × 3
#&gt;   country     `1999` `2000`
#&gt;   &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;
#&gt; 1 Afghanistan    745   2666
#&gt; 2 Brazil       37737  80488
#&gt; 3 China       212258     NA</code></pre>
<div class="sourceCode" id="cb1871"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">na_table4a</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">`1999`</span>, <span class="va">`2000`</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"year"</span>, values_to <span class="op">=</span> <span class="st">"cases"</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; # A tibble: 6 × 3
#&gt;   country     year   cases
#&gt;   &lt;chr&gt;       &lt;chr&gt;  &lt;dbl&gt;
#&gt; 1 Afghanistan 1999     745
#&gt; 2 Afghanistan 2000    2666
#&gt; 3 Brazil      1999   37737
#&gt; 4 Brazil      2000   80488
#&gt; 5 China       1999  212258
#&gt; 6 China       2000      NA</code></pre>
<p>만약 긴 형식에서는 결측치인 행을 없애고 싶으면 <code>values_drop_na</code> 인수를 TRUE로 설정한다.</p>
<div class="sourceCode" id="cb1873"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">na_long_table4a</span> <span class="op">&lt;-</span> <span class="va">na_table4a</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">`1999`</span>, <span class="va">`2000`</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>               values_to <span class="op">=</span> <span class="st">"cases"</span>, values_drop_na <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">na_long_table4a</span></span></code></pre></div>
<pre><code>#&gt; # A tibble: 5 × 3
#&gt;   country     year   cases
#&gt;   &lt;chr&gt;       &lt;chr&gt;  &lt;dbl&gt;
#&gt; 1 Afghanistan 1999     745
#&gt; 2 Afghanistan 2000    2666
#&gt; 3 Brazil      1999   37737
#&gt; 4 Brazil      2000   80488
#&gt; 5 China       1999  212258</code></pre>
</div>
<div id="gather-함수" class="section level4 unnumbered">
<h4>
<code>gather</code> 함수<a class="anchor" aria-label="anchor" href="#gather-%ED%95%A8%EC%88%98"><i class="fas fa-link"></i></a>
</h4>
<p><code>tidyr</code> 패키지는 1.0 버전이 출시되면서 많은 변화가 있었다. 이전 버전의 에서는 <code><a href="https://tidyr.tidyverse.org/reference/gather.html">gather()</a></code> 함수가 <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> 함수의 역할을 수행하였다. 그리고 호환성을 위해 현재의 버전에서도 <code><a href="https://tidyr.tidyverse.org/reference/gather.html">gather()</a></code> 함수를 사용할 수 있다. 아직도 많은 R 관련 책에서 이 함수를 사용하고 있어서 사용법을 여기에 기술한다.</p>
<div class="sourceCode" id="cb1875"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">table4a</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">`1999`</span>, <span class="va">`2000`</span>, key <span class="op">=</span> <span class="st">"year"</span>, value <span class="op">=</span><span class="st">"cases"</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; # A tibble: 6 × 3
#&gt;   country     year   cases
#&gt;   &lt;chr&gt;       &lt;chr&gt;  &lt;dbl&gt;
#&gt; 1 Afghanistan 1999     745
#&gt; 2 Brazil      1999   37737
#&gt; 3 China       1999  212258
#&gt; 4 Afghanistan 2000    2666
#&gt; 5 Brazil      2000   80488
#&gt; 6 China       2000  213766</code></pre>
<ul>
<li>
<code>pivot_longer</code>와 유사한 형식인데, <code>gather</code>에서는 합칠 열의 이름을 각각의 인수로 전달된다.</li>
<li>
<code>names_to</code>와 <code>values_to</code>라는 원 데이터 입장에서의 인수 이름이 <code>gather</code>에서는 합쳐진 데이터 입장에서의 인수 이름인 <code>key</code>와 <code>value</code>라고 기술된다.</li>
</ul>
</div>
</div>
<div id="subsec-pivot-wider" class="section level3" number="9.3.2">
<h3>
<span class="header-section-number">9.3.2</span> <code>pivot_wider</code>: 한 열에 기술된 여러 변수의 데이터를 여러 열로 넓게 펼치기<a class="anchor" aria-label="anchor" href="#subsec-pivot-wider"><i class="fas fa-link"></i></a>
</h3>
<p>정돈 데이터는 하나의 열은 하나의 변수에 대응을 해야 한다. 그러나 현실의 데이터에서는 한 열에 여러 변수의 값이 표현되어 있는 경우도 있다. 다음 데이터는 세 나라의 어떤 년도의 사건의 발생 건수와 인구수가 <code>count</code>라는 한 열에 표현되었다. 그렇기 때문에 <code>count</code> 열은 인구수와 사건 횟수라는 두 변수의 값을 모두 포함한 열이 되었다.</p>
<div class="sourceCode" id="cb1877"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">table2</span></span></code></pre></div>
<pre><code>#&gt; # A tibble: 12 × 4
#&gt;    country      year type            count
#&gt;    &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;
#&gt;  1 Afghanistan  1999 cases             745
#&gt;  2 Afghanistan  1999 population   19987071
#&gt;  3 Afghanistan  2000 cases            2666
#&gt;  4 Afghanistan  2000 population   20595360
#&gt;  5 Brazil       1999 cases           37737
#&gt;  6 Brazil       1999 population  172006362
#&gt;  7 Brazil       2000 cases           80488
#&gt;  8 Brazil       2000 population  174504898
#&gt;  9 China        1999 cases          212258
#&gt; 10 China        1999 population 1272915272
#&gt; 11 China        2000 cases          213766
#&gt; 12 China        2000 population 1280428583</code></pre>
<p><code>table2</code>를 정돈 데이터로 바꾸려면 <code>count</code> 열의 데이터를 인구수와 사건 횟수를 나타내는 열로 분리하여 한다. <code>tidyr</code>의 <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> 함수는 그러한 역할을 수행한다.</p>
<div class="sourceCode" id="cb1879"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">table2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">type</span>, values_from <span class="op">=</span> <span class="va">count</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; # A tibble: 6 × 4
#&gt;   country      year  cases population
#&gt;   &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
#&gt; 1 Afghanistan  1999    745   19987071
#&gt; 2 Afghanistan  2000   2666   20595360
#&gt; 3 Brazil       1999  37737  172006362
#&gt; 4 Brazil       2000  80488  174504898
#&gt; 5 China        1999 212258 1272915272
#&gt; 6 China        2000 213766 1280428583</code></pre>
<ul>
<li>
<code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code>는 결과 펼쳐진 결과 데이터에서 열의 이름으로 사용될 변수를 <code>names_from</code> 인수로 지정한다.</li>
<li>펼쳐진 결과 데이터에서 열의 값으로 사용될 변수를 <code>values_from</code> 인수로 지정한다.</li>
</ul>
<p><code>names_from</code>과 <code>values_from</code> 인수를 지정할 때, 원 데이터의 열을 지정하는 것이므로 따옴표 없이 변수로서 지정한다.</p>
<p>다음 그림은 앞의 <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> 함수의 작동 방식을 보여준다.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-19"></span>
<img src="img/tidy-spread.png" alt="pivot_wider의 작동 방식 (출처: R for Data Science)" width="60%"><p class="caption">
Figure 9.2: pivot_wider의 작동 방식 (출처: R for Data Science)
</p>
</div>
<div id="결측치가-있는-경우-1" class="section level4 unnumbered">
<h4>결측치가 있는 경우<a class="anchor" aria-label="anchor" href="#%EA%B2%B0%EC%B8%A1%EC%B9%98%EA%B0%80-%EC%9E%88%EB%8A%94-%EA%B2%BD%EC%9A%B0-1"><i class="fas fa-link"></i></a>
</h4>
<p>앞서 <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code>에서 중국의 2000년도 데이터에 결측값이 있는 행을 제거하여 데이터 프레임을 만들었다.</p>
<div class="sourceCode" id="cb1881"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">na_long_table4a</span></span></code></pre></div>
<pre><code>#&gt; # A tibble: 5 × 3
#&gt;   country     year   cases
#&gt;   &lt;chr&gt;       &lt;chr&gt;  &lt;dbl&gt;
#&gt; 1 Afghanistan 1999     745
#&gt; 2 Afghanistan 2000    2666
#&gt; 3 Brazil      1999   37737
#&gt; 4 Brazil      2000   80488
#&gt; 5 China       1999  212258</code></pre>
<p>만약 이 데이터를 넓은 형식으로 합치면 어떤 결과가 나올까? 결과에서 보듯이 결측이 있는 곳이 NA로 표시되고 데이터가 넓은 형식으로 변환된다.</p>
<div class="sourceCode" id="cb1883"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">na_long_table4a</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">year</span>, values_from <span class="op">=</span> <span class="va">cases</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; # A tibble: 3 × 3
#&gt;   country     `1999` `2000`
#&gt;   &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;
#&gt; 1 Afghanistan    745   2666
#&gt; 2 Brazil       37737  80488
#&gt; 3 China       212258     NA</code></pre>
</div>
<div id="spread-함수" class="section level4 unnumbered">
<h4>
<code>spread</code> 함수<a class="anchor" aria-label="anchor" href="#spread-%ED%95%A8%EC%88%98"><i class="fas fa-link"></i></a>
</h4>
<p><code>tidyr</code> 패키지는 1.0 버전이 출시되면서 많은 변화가 있었다. 이전 버전의 에서는 <code><a href="https://tidyr.tidyverse.org/reference/spread.html">spread()</a></code> 함수가 <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> 함수의 역할을 수행하였다. 그리고 호환성을 위해 현재의 버전에서도 <code><a href="https://tidyr.tidyverse.org/reference/spread.html">spread()</a></code> 함수를 사용할 수 있다. 아직도 많은 R 관련 책에서 이 함수를 사용하고 있어서 사용법을 여기에 기술한다.</p>
<div class="sourceCode" id="cb1885"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">table2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/spread.html">spread</a></span><span class="op">(</span>key <span class="op">=</span> <span class="va">type</span>, value <span class="op">=</span> <span class="va">count</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; # A tibble: 6 × 4
#&gt;   country      year  cases population
#&gt;   &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
#&gt; 1 Afghanistan  1999    745   19987071
#&gt; 2 Afghanistan  2000   2666   20595360
#&gt; 3 Brazil       1999  37737  172006362
#&gt; 4 Brazil       2000  80488  174504898
#&gt; 5 China        1999 212258 1272915272
#&gt; 6 China        2000 213766 1280428583</code></pre>
<ul>
<li>
<code>pivot_wider</code>와 유사한 형식인데 <code>names_from</code>와 <code>values_from</code>이라는 인수 이름이 <code>spread</code>에서는 <code>key</code>와 <code>value</code>라고 기술된다.</li>
</ul>
</div>
</div>
<div id="seperate-한-셀을-여러-셀로-분리하기" class="section level3" number="9.3.3">
<h3>
<span class="header-section-number">9.3.3</span> <code>seperate</code>: 한 셀을 여러 셀로 분리하기<a class="anchor" aria-label="anchor" href="#seperate-%ED%95%9C-%EC%85%80%EC%9D%84-%EC%97%AC%EB%9F%AC-%EC%85%80%EB%A1%9C-%EB%B6%84%EB%A6%AC%ED%95%98%EA%B8%B0"><i class="fas fa-link"></i></a>
</h3>
<p>한 셀에 여러 값이 기술되어 있으면 정돈 형식의 데이터가 아니다. <code>table3</code>의 <code>rate</code> 열은 사건의 수와 인구수 데이터가 문자열 형식으로 표현된 열이다.</p>
<div class="sourceCode" id="cb1887"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">table3</span></span></code></pre></div>
<pre><code>#&gt; # A tibble: 6 × 3
#&gt;   country      year rate             
#&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;            
#&gt; 1 Afghanistan  1999 745/19987071     
#&gt; 2 Afghanistan  2000 2666/20595360    
#&gt; 3 Brazil       1999 37737/172006362  
#&gt; 4 Brazil       2000 80488/174504898  
#&gt; 5 China        1999 212258/1272915272
#&gt; 6 China        2000 213766/1280428583</code></pre>
<div id="특정-문자를-기준으로-분리하기" class="section level4" number="9.3.3.1">
<h4>
<span class="header-section-number">9.3.3.1</span> 특정 문자를 기준으로 분리하기<a class="anchor" aria-label="anchor" href="#%ED%8A%B9%EC%A0%95-%EB%AC%B8%EC%9E%90%EB%A5%BC-%EA%B8%B0%EC%A4%80%EC%9C%BC%EB%A1%9C-%EB%B6%84%EB%A6%AC%ED%95%98%EA%B8%B0"><i class="fas fa-link"></i></a>
</h4>
<p><code>seperate()</code>는 정해진 열을 <code>sep</code>에 지정된 문자를 기준으로 분리하여 분리된 값을 <code>into</code>에 지정된 열 이름으로 분리한다. 앞의 다른 함수와 마찬가지로 원 데이터의 열은 변수로서 따옴표 없이 지정되었고 결과 데이터에 사용될 열 이름은 따옴표를 사용하여 문자열로 전달되었다.</p>
<div class="sourceCode" id="cb1889"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">table3</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">rate</span>, into<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cases"</span>, <span class="st">"population"</span><span class="op">)</span>, sep<span class="op">=</span><span class="st">"/"</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; # A tibble: 6 × 4
#&gt;   country      year cases  population
#&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;     
#&gt; 1 Afghanistan  1999 745    19987071  
#&gt; 2 Afghanistan  2000 2666   20595360  
#&gt; 3 Brazil       1999 37737  172006362 
#&gt; 4 Brazil       2000 80488  174504898 
#&gt; 5 China        1999 212258 1272915272
#&gt; 6 China        2000 213766 1280428583</code></pre>
<p>다음 그림은 앞의 <code>seperate()</code> 함수의 작동 방식을 보여준다.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-25"></span>
<img src="img/tidy-separate.png" alt="separate의 작동 방식 (출처: R for Data Science)" width="60%"><p class="caption">
Figure 9.3: separate의 작동 방식 (출처: R for Data Science)
</p>
</div>
<p><code>sep</code>은 구분자로 사용할 일반 문자뿐 아니라 정규 표현식을 사용하여 문자를 분리할 수 있다.</p>
</div>
<div id="분리한-열의-형변환" class="section level4" number="9.3.3.2">
<h4>
<span class="header-section-number">9.3.3.2</span> 분리한 열의 형변환<a class="anchor" aria-label="anchor" href="#%EB%B6%84%EB%A6%AC%ED%95%9C-%EC%97%B4%EC%9D%98-%ED%98%95%EB%B3%80%ED%99%98"><i class="fas fa-link"></i></a>
</h4>
<p>앞의 결과를 보면 <code>rate</code> 열의 데이터가 문자열이기 때문에 결과 열도 모두 문자열 형식임을 볼 수 있다. 그런데 <code>cases</code>와 <code>population</code> 열은 모두 숫자로서 의미를 가지고 있으므로 숫자로 변환되는 것이 좋다. 셀의 내용을 분리한 후 숫자나 논리값으로 변형이 가능하면 변형을 하려면 <code>convert</code> 인수를 TRUE로 설정한다.</p>
<div class="sourceCode" id="cb1891"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">table3</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">rate</span>, into<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cases"</span>, <span class="st">"population"</span><span class="op">)</span>, sep<span class="op">=</span><span class="st">"/"</span>, convert <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span><span class="va">x</span></span></code></pre></div>
<pre><code>#&gt; # A tibble: 6 × 4
#&gt;   country      year  cases population
#&gt;   &lt;chr&gt;       &lt;dbl&gt;  &lt;int&gt;      &lt;int&gt;
#&gt; 1 Afghanistan  1999    745   19987071
#&gt; 2 Afghanistan  2000   2666   20595360
#&gt; 3 Brazil       1999  37737  172006362
#&gt; 4 Brazil       2000  80488  174504898
#&gt; 5 China        1999 212258 1272915272
#&gt; 6 China        2000 213766 1280428583</code></pre>
<div class="sourceCode" id="cb1893"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>total_cases<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">cases</span><span class="op">)</span>, mean_pop<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">population</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; # A tibble: 1 × 2
#&gt;   total_cases   mean_pop
#&gt;         &lt;int&gt;      &lt;dbl&gt;
#&gt; 1      547660 490072924.</code></pre>
</div>
<div id="문자-수를-기준으로-분리하기" class="section level4" number="9.3.3.3">
<h4>
<span class="header-section-number">9.3.3.3</span> 문자 수를 기준으로 분리하기<a class="anchor" aria-label="anchor" href="#%EB%AC%B8%EC%9E%90-%EC%88%98%EB%A5%BC-%EA%B8%B0%EC%A4%80%EC%9C%BC%EB%A1%9C-%EB%B6%84%EB%A6%AC%ED%95%98%EA%B8%B0"><i class="fas fa-link"></i></a>
</h4>
<p><code>sep</code> 인수에 문자 대신 숫자를 입력하면 문자 수를를 기준으로 열을 분리한다. 양수이면 왼쪽에서 시작하여 <code>sep</code>에 입력된 문자 수까지와 그 이후로 열을 분리하고, 음수이면 오른쪽을 기준으로 <code>sep</code>에 입력된 문자 수까지와 그 이전으로 열을 분리한다.</p>
<div class="sourceCode" id="cb1895"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">table3</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">rate</span>, into<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cases"</span>, <span class="st">"population"</span><span class="op">)</span>, sep<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; # A tibble: 6 × 4
#&gt;   country      year cases population    
#&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;         
#&gt; 1 Afghanistan  1999 745   /19987071     
#&gt; 2 Afghanistan  2000 266   6/20595360    
#&gt; 3 Brazil       1999 377   37/172006362  
#&gt; 4 Brazil       2000 804   88/174504898  
#&gt; 5 China        1999 212   258/1272915272
#&gt; 6 China        2000 213   766/1280428583</code></pre>
<div class="sourceCode" id="cb1897"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">table3</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">rate</span>, into<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cases"</span>, <span class="st">"population"</span><span class="op">)</span>, sep<span class="op">=</span><span class="op">-</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; # A tibble: 6 × 4
#&gt;   country      year cases          population
#&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;     
#&gt; 1 Afghanistan  1999 745/19987      071       
#&gt; 2 Afghanistan  2000 2666/20595     360       
#&gt; 3 Brazil       1999 37737/172006   362       
#&gt; 4 Brazil       2000 80488/174504   898       
#&gt; 5 China        1999 212258/1272915 272       
#&gt; 6 China        2000 213766/1280428 583</code></pre>
<p>앞의 예에서 숫자열인 <code>year</code>에 적용하여 세기와 나머지 년도로 분리해 내보자.</p>
<div class="sourceCode" id="cb1899"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">table3</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">year</span>, into<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"century"</span>, <span class="st">"year"</span><span class="op">)</span>, sep<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; # A tibble: 6 × 4
#&gt;   country     century year  rate             
#&gt;   &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;            
#&gt; 1 Afghanistan 19      99    745/19987071     
#&gt; 2 Afghanistan 20      00    2666/20595360    
#&gt; 3 Brazil      19      99    37737/172006362  
#&gt; 4 Brazil      20      00    80488/174504898  
#&gt; 5 China       19      99    212258/1272915272
#&gt; 6 China       20      00    213766/1280428583</code></pre>
<p>만약 세기와 연도를 숫자로 표현하는 것이 필요하다면 앞서 설명한 것처럼 <code>convert</code> 인수를 TRUE로 설정하면 된다. 이 경우 00년도가 모두 숫자 0으로 변환된 것을 볼 수 있다.</p>
<div class="sourceCode" id="cb1901"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">table3</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">year</span>, into<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"century"</span>, <span class="st">"year"</span><span class="op">)</span>, sep<span class="op">=</span><span class="fl">2</span>, convert <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; # A tibble: 6 × 4
#&gt;   country     century  year rate             
#&gt;   &lt;chr&gt;         &lt;int&gt; &lt;int&gt; &lt;chr&gt;            
#&gt; 1 Afghanistan      19    99 745/19987071     
#&gt; 2 Afghanistan      20     0 2666/20595360    
#&gt; 3 Brazil           19    99 37737/172006362  
#&gt; 4 Brazil           20     0 80488/174504898  
#&gt; 5 China            19    99 212258/1272915272
#&gt; 6 China            20     0 213766/1280428583</code></pre>
</div>
</div>
<div id="unite-여러-셀의-데이터를-하나의-셀로-병합하기" class="section level3" number="9.3.4">
<h3>
<span class="header-section-number">9.3.4</span> <code>unite</code>: 여러 셀의 데이터를 하나의 셀로 병합하기<a class="anchor" aria-label="anchor" href="#unite-%EC%97%AC%EB%9F%AC-%EC%85%80%EC%9D%98-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A5%BC-%ED%95%98%EB%82%98%EC%9D%98-%EC%85%80%EB%A1%9C-%EB%B3%91%ED%95%A9%ED%95%98%EA%B8%B0"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code> 함수와 반대 작용을 하는 함수가 <code><a href="https://tidyr.tidyverse.org/reference/unite.html">unite()</a></code> 함수이다. <code><a href="https://tidyr.tidyverse.org/reference/unite.html">unite()</a></code> 함수는 여러 셀의 내용을 하나의 셀로 합친다. <code>table5</code>는 년도 데이터가 세기(<code>century</code>)와 나머지 년도(<code>year</code>)로 나뉘어져 있는 데이터이다. 세기와 무관하게 년도 별로 데이터를 분석하려고 하면 이 두 열을 합쳐서 온전한 년도 데이터를 만들어야 한다.</p>
<div class="sourceCode" id="cb1903"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">table5</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unite.html">unite</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">century</span>, <span class="va">year</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; # A tibble: 6 × 3
#&gt;   country     year  rate             
#&gt;   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;            
#&gt; 1 Afghanistan 19_99 745/19987071     
#&gt; 2 Afghanistan 20_00 2666/20595360    
#&gt; 3 Brazil      19_99 37737/172006362  
#&gt; 4 Brazil      20_00 80488/174504898  
#&gt; 5 China       19_99 212258/1272915272
#&gt; 6 China       20_00 213766/1280428583</code></pre>
<p><code><a href="https://tidyr.tidyverse.org/reference/unite.html">unite()</a></code>의 기본 설정은 <code>_</code>을 구분자로 사용하여 합쳐진 셀의 내용을 연결한다. 이를 조정하려면, <code>sep</code> 인수를 설정하면 된다. 다음처럼 하면 구분자 없이 연결을 수행한다.</p>
<div class="sourceCode" id="cb1905"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">table5</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unite.html">unite</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">century</span>, <span class="va">year</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"year"</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; # A tibble: 6 × 3
#&gt;   country     year  rate             
#&gt;   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;            
#&gt; 1 Afghanistan 1999  745/19987071     
#&gt; 2 Afghanistan 2000  2666/20595360    
#&gt; 3 Brazil      1999  37737/172006362  
#&gt; 4 Brazil      2000  80488/174504898  
#&gt; 5 China       1999  212258/1272915272
#&gt; 6 China       2000  213766/1280428583</code></pre>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="ch-visualization.html"><span class="header-section-number">8</span> ggplot2를 이용한 데이터 시각화</a></div>
<div class="next"><a href="ch-R-Programming-Structure.html"><span class="header-section-number">10</span> R 프로그래밍 구조</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#ch-R-Advanced-Data-Mgmt"><span class="header-section-number">9</span> R 고급 데이터 변환</a></li>
<li>
<a class="nav-link" href="#%EB%8D%B0%EC%9D%B4%ED%84%B0%EC%9D%98-%EB%8B%A8%EC%88%9C-%EA%B2%B0%ED%95%A9"><span class="header-section-number">9.1</span> 데이터의 단순 결합</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A5%BC-%ED%96%89%EC%9C%BC%EB%A1%9C-%EA%B2%B0%ED%95%A9%ED%95%98%EA%B8%B0"><span class="header-section-number">9.1.1</span> 데이터를 행으로 결합하기</a></li>
<li><a class="nav-link" href="#%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A5%BC-%EC%97%B4%EB%A1%9C-%EA%B2%B0%ED%95%A9%ED%95%98%EA%B8%B0"><span class="header-section-number">9.1.2</span> 데이터를 열로 결합하기</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#%EA%B4%80%EA%B3%84%ED%98%95-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4%EC%B2%98%EB%9F%BC-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EA%B2%B0%ED%95%A9%ED%95%98%EA%B8%B0"><span class="header-section-number">9.2</span> 관계형 데이터베이스처럼 데이터 결합하기</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#inner-join%EA%B3%BC-outer-join"><span class="header-section-number">9.2.1</span> Inner join과 outer join</a></li>
<li><a class="nav-link" href="#filtering-join"><span class="header-section-number">9.2.2</span> Filtering join</a></li>
<li><a class="nav-link" href="#join%EC%9D%84-%EC%88%98%ED%96%89%ED%95%98%EB%8A%94-%EB%8B%A4%EB%A5%B8-%EB%B0%A9%EB%B2%95%EB%93%A4"><span class="header-section-number">9.2.3</span> Join을 수행하는 다른 방법들</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#sec-tidyr"><span class="header-section-number">9.3</span> tidyr 패키지를 이용하여 정돈 데이터 형식으로 바꾸기</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#pivot_longer-%EC%97%AC%EB%9F%AC-%EC%97%B4%EC%97%90-%EA%B1%B8%EC%B9%9C-%ED%95%9C-%EB%B3%80%EC%88%98%EC%9D%98-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A5%BC-%ED%95%98%EB%82%98%EC%9D%98-%EC%97%B4%EB%A1%9C-%EA%B8%B8%EA%B2%8C-%EB%AA%A8%EC%9C%BC%EA%B8%B0"><span class="header-section-number">9.3.1</span> pivot_longer: 여러 열에 걸친 한 변수의 데이터를 하나의 열로 길게 모으기</a></li>
<li><a class="nav-link" href="#subsec-pivot-wider"><span class="header-section-number">9.3.2</span> pivot_wider: 한 열에 기술된 여러 변수의 데이터를 여러 열로 넓게 펼치기</a></li>
<li><a class="nav-link" href="#seperate-%ED%95%9C-%EC%85%80%EC%9D%84-%EC%97%AC%EB%9F%AC-%EC%85%80%EB%A1%9C-%EB%B6%84%EB%A6%AC%ED%95%98%EA%B8%B0"><span class="header-section-number">9.3.3</span> seperate: 한 셀을 여러 셀로 분리하기</a></li>
<li><a class="nav-link" href="#unite-%EC%97%AC%EB%9F%AC-%EC%85%80%EC%9D%98-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A5%BC-%ED%95%98%EB%82%98%EC%9D%98-%EC%85%80%EB%A1%9C-%EB%B3%91%ED%95%A9%ED%95%98%EA%B8%B0"><span class="header-section-number">9.3.4</span> unite: 여러 셀의 데이터를 하나의 셀로 병합하기</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R 프로그래밍 (개정판)</strong>" was written by Kilhwan Kim. It was last built on 2023-09-06.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
